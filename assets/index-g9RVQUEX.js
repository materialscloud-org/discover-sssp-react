import{d as M,c as L,t as R,e as X,f as O,g as N,h as k,P as $,r as b,S as I,j as m,L as Y}from"./index-CzAkSNEc.js";import{c as B,R as V,C as v,F as P}from"./params-BXtEbFMS.js";function A(t){const e=t.length,s=t[0].length,n=new Array(s);for(let o=0;o<s;o++){n[o]=new Array(e);for(let r=0;r<e;r++)n[o][r]=t[r][o]}return n}const C=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function T(t){return t<C.length?C[t]:`hsl(${t*47%360}, 70%, 50%)`}function G(t){const e=new Set;return t.map(n=>{const o=n.name||"",r=!e.has(o);return r&&e.add(o),{...n,legendgroup:o,showlegend:r}})}function W(t){const e=[],s=[];let n=null;return t.paths.forEach((o,r)=>{const l=o.x,a=o.values;r>0&&(e.push(null),s.forEach(f=>f.push(null))),l.forEach((f,p)=>{f===n&&(e.push(null),s.forEach(i=>i.push(null))),e.push(f),n=f,a.forEach((i,d)=>{s[d]||(s[d]=[]),s[d].push(i[p])})})}),{xs:e,ys:s}}function q(t){const e={GAMMA:"Γ",DELTA:"Δ",SIGMA:"Σ",LAMBDA:"Λ"};Object.keys(e).forEach(n=>{const o=new RegExp(n,"gi");t=t.replace(o,e[n])}),t=t.replace(/\bG\b/g,"Γ"),t=t.replace(/-/g,"—");const s={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"};return t=t.replace(/_(.)/g,(n,o)=>s[o]||n),t}function z(t=td.paths){const e=[0];for(const s of t)s.x.length<3||e.push(s.x[s.x.length-1]);return e}function H(t){const e=t.flat(),s=[];s.push(e[0]);for(let n=1;n<e.length-1;n++)e[n]===e[n+1]?(s.push(e[n]),n++):(s.push(e[n]+"|"+e[n+1]),n++);return s.push(e[e.length-1]),s}function D(t,e="x",s="y"){let n=1/0,o=-1/0,r=1/0,l=-1/0;for(const a of t){const f=a.xaxis===e||!a.xaxis&&e==="x",p=a.yaxis===s||!a.yaxis&&s==="y";if(!(!f||!p)){for(const i of a.x??[])typeof i=="number"&&(n=Math.min(n,i),o=Math.max(o,i));for(const i of a.y??[])typeof i=="number"&&(r=Math.min(r,i),l=Math.max(l,i))}}return{x:n===1/0?null:[n,o],y:r===1/0?null:[r,l]}}function S(t,e,s,n={}){return{x:t,y:e,mode:"lines",type:"scatter",name:`Fermi [${s}eV]`,legendgroup:`fermi-${s}`,showlegend:n.showlegend??!0,line:{color:"green",width:1.25,dash:"dash"},...n}}function J(t,e,s,n){const o=[...e];if(s&&!n){const{y:r}=D(e);for(const l of t)o.push(S([l,l],[r[0],r[1]],l))}else if(n&&!s){const{x:r}=D(e);for(const l of t)o.push(S([r[0],r[1]],[l,l],l))}else if(n&&s){const{x:r}=D(e,"x2","y"),{x:l}=D(e,"x","y");for(const a of t)o.push(S([l[0],l[1]],[a,a],a)),o.push(S([r[0],r[1]],[a,a],a,{showlegend:!1,xaxis:"x2",yaxis:"y"}))}return o}function K(t,e,s={}){const n=[];return e.forEach((o,r)=>{n.push({name:s.name,legendgroup:s.name,showlegend:r===0,...R,...s,x:t,y:o})}),n}function Q(t=[],e=[]){return M.all([L,{xaxis:{tickvals:e,ticktext:t},yaxis:{}}])}function U(t){const s=H(t[0].bandsData.path).map(q),n=z(t[0].bandsData.paths),o=Q(s,n);let r=[];for(const[l,a]of t.entries()){let f=a.traceFormat;(!f||Object.keys(f).length===0)&&(f={name:`Band Structure ${l}`,line:{color:T(l),width:1}});const p=a.bandsData,{xs:i,ys:d}=W(p),x=K(i,d,f);r.push(...x)}return{bandTraces:r,bandLayout:o}}function Z(t="h"){let e;return t==="v"?e=O:e=N,e}function ee(t,e="h",s={}){const n=e==="v"?t.y:t.x,o=e==="v"?t.x:t.y;return{...X,...s,x:n,y:o}}function te(t,e="h"){const s=[];for(const[o,r]of t.entries()){let l=r.traceFormat;(!l||Object.keys(l).length===0)&&(l={name:`DOS ${o}`,line:{color:T(o),width:2}});const a=r.dosData,f=ee(a,e,l);s.push(f)}const n=Z(e);return{dosTraces:s,dosLayout:n}}function se(t,e,s,n={},o=1){const r=A(s),l=A(e),a=[];return l.forEach((f,p)=>{const i=r[p],d=new Float64Array(f.length),x=new Float64Array(f.length);for(let c=0;c<f.length;c++){const y=i[c]*o;d[c]=f[c]+y,x[c]=f[c]-y}const u=t.length,h=new Float32Array(u*2),g=new Float32Array(u*2);for(let c=0;c<u;c++)h[c]=t[c],g[c]=x[c],h[2*u-1-c]=t[c],g[2*u-1-c]=d[c];a.push({name:n.name,legendgroup:n.name,type:"scatter",mode:"lines",fill:"toself",...n,showlegend:p===0,x:h,y:g})}),a}function ne(t,e){for(const s in t)t[s]!==null&&typeof t[s]=="object"&&!Array.isArray(t[s])&&e[s]&&typeof e[s]=="object"&&!Array.isArray(e[s])?e[s]=M(e[s],t[s]):e[s]=t[s]}function oe(t,{bandsDataArray:e=[],dosDataArray:s=[],fermiLevels:n=[],customTraces:o=[],settings:r={}}){let l=[],a={},f=[],p=[],i={};typeof n=="number"&&(n=[n]);const d=e.length>0,x=s.length>0;if(d){const c=U(e);l=c.bandTraces,a=c.bandLayout;for(const[y,w]of e.entries())if(w.hasOwnProperty("projections"))for(const[j,E]of w.projections.entries()){const _=E.traceFormat&&Object.keys(E.traceFormat).length>0?E.traceFormat:{name:`Projection ${j}`,line:{color:T(j),width:0}};f.push(...se(w.bandsData.x,w.bandsData.y,E.projData.weights,_))}}if(x){const y=te(s,d?"v":"h");p=y.dosTraces,i=y.dosLayout}let u={},h=[];if(x&&!d)h=p,u={...i,showlegend:(i==null?void 0:i.showlegend)??!0};else if(d&&!x)h=[...l,...f],u={...a,showlegend:(a==null?void 0:a.showlegend)??!0};else if(x&&d){p=p.map(y=>({...y,xaxis:"x2",yaxis:"y"}));const c=G([...f,...p]);h=[...l,...c],u={...k,xaxis:{...k.xaxis||{},...(a==null?void 0:a.xaxis)||{}},xaxis2:{...k.xaxis2||{},...(i==null?void 0:i.xaxis2)||{}},yaxis:{...k.yaxis||{},...(a==null?void 0:a.yaxis)||{},...(i==null?void 0:i.yaxis)||{}}}}for(const c of o)console.log(c),c.target==="dos"?h.push({...c,xaxis:"x2",yaxis:"y"}):c.target==="bands"?h.push({...c,xaxis:"x",yaxis:"y"}):h.push({...c});const g=J(n,h,x,d);ne(r,u),$.react(t,g,u,{displaylogo:!1,responsive:!0})}const F={"pseudo-controls":"_pseudo-controls_1auve_1","pseudo-checkbox":"_pseudo-checkbox_1auve_4","bands-plot":"_bands-plot_1auve_1","bands-note":"_bands-note_1auve_1"},ce=({element:t,activeAccuracy:e})=>{const s=b.useRef(null),[n,o]=b.useState(),[r,l]=b.useState(!0),[a,f]=b.useState(["REF"]),[p,i]=b.useState([]),[d,x]=b.useState({});return b.useEffect(()=>{if(!t)return;new I().fetchBandsData(e).then(h=>{const g=h[t];o(g);const c=g&&Object.keys(g);i(c),x(c==null?void 0:c.reduce((y,w,j)=>(y[w]=B[j%B.length],y),{}))}).catch(h=>{console.error("Error fetching bands data:",h),o(void 0),i([]),x({})}).finally(()=>{l(!1)})},[e,t]),b.useEffect(()=>{if(n&&s.current){const u=a.map(h=>({bandsData:n[h],traceFormat:{line:{color:d[h]||"black"}}}));oe(s.current,{bandsDataArray:u,settings:{showlegend:!1}})}},[a,n]),r?m.jsx(Y,{}):n?m.jsxs("div",{id:"bands-plots",children:[m.jsxs(V,{children:[m.jsxs(v,{md:3,lg:2,className:F["pseudo-controls"],children:[m.jsx(P,{type:"checkbox",id:"all",label:"Select all",defaultChecked:!1,className:F["pseudo-checkbox"],style:{color:"black"},onChange:u=>{u.target.checked?f(p):f(["REF"])}}),p.map(u=>m.jsx(P,{type:"checkbox",id:u,label:u,checked:a.includes(u),disabled:u==="REF",className:F["pseudo-checkbox"],style:{color:d[u]},onChange:h=>{h.target.checked?f([...a,u]):f(a.filter(g=>g!==u))}},u))]}),m.jsx(v,{children:m.jsx("div",{ref:s,id:F["bands-plot"]})})]}),m.jsx("div",{id:F["bands-note"],children:"Electronic band structure along high-symmetry path. The reference energy (0 eV) corresponds to the Fermi level."})]}):m.jsx("span",{children:"No data available"})};export{ce as default};
