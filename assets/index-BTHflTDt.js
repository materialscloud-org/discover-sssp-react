import{d as k,c as C,t as X,e as O,f as R,g as _,h as E,P as $,r as b,S as I,j as m,L as Y}from"./index-DjnaycTG.js";import{c as T,R as V,C as B,P as G}from"./PseudosCheckboxes-BmQKwht_.js";function A(t){const e=t.length,s=t[0].length,n=new Array(s);for(let o=0;o<s;o++){n[o]=new Array(e);for(let a=0;a<e;a++)n[o][a]=t[a][o]}return n}const v=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function P(t){return t<v.length?v[t]:`hsl(${t*47%360}, 70%, 50%)`}function N(t){const e=new Set;return t.map(n=>{const o=n.name||"",a=!e.has(o);return a&&e.add(o),{...n,legendgroup:o,showlegend:a}})}function W(t){const e=[],s=[];let n=null;return t.paths.forEach((o,a)=>{const i=o.x,r=o.values;a>0&&(e.push(null),s.forEach(f=>f.push(null))),i.forEach((f,u)=>{f===n&&(e.push(null),s.forEach(l=>l.push(null))),e.push(f),n=f,r.forEach((l,h)=>{s[h]||(s[h]=[]),s[h].push(l[u])})})}),{xs:e,ys:s}}function q(t){const e={GAMMA:"Γ",DELTA:"Δ",SIGMA:"Σ",LAMBDA:"Λ"};Object.keys(e).forEach(n=>{const o=new RegExp(n,"gi");t=t.replace(o,e[n])}),t=t.replace(/\bG\b/g,"Γ"),t=t.replace(/-/g,"—");const s={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"};return t=t.replace(/_(.)/g,(n,o)=>s[o]||n),t}function z(t=td.paths){const e=[0];for(const s of t)s.x.length<3||e.push(s.x[s.x.length-1]);return e}function H(t){const e=t.flat(),s=[];s.push(e[0]);for(let n=1;n<e.length-1;n++)e[n]===e[n+1]?(s.push(e[n]),n++):(s.push(e[n]+"|"+e[n+1]),n++);return s.push(e[e.length-1]),s}function D(t,e="x",s="y"){let n=1/0,o=-1/0,a=1/0,i=-1/0;for(const r of t){const f=r.xaxis===e||!r.xaxis&&e==="x",u=r.yaxis===s||!r.yaxis&&s==="y";if(!(!f||!u)){for(const l of r.x??[])typeof l=="number"&&(n=Math.min(n,l),o=Math.max(o,l));for(const l of r.y??[])typeof l=="number"&&(a=Math.min(a,l),i=Math.max(i,l))}}return{x:n===1/0?null:[n,o],y:a===1/0?null:[a,i]}}function S(t,e,s,n={}){return{x:t,y:e,mode:"lines",type:"scatter",name:`Fermi [${s}eV]`,legendgroup:`fermi-${s}`,showlegend:n.showlegend??!0,line:{color:"green",width:1.25,dash:"dash"},...n}}function J(t,e,s,n){const o=[...e];if(s&&!n){const{y:a}=D(e);for(const i of t)o.push(S([i,i],[a[0],a[1]],i))}else if(n&&!s){const{x:a}=D(e);for(const i of t)o.push(S([a[0],a[1]],[i,i],i))}else if(n&&s){const{x:a}=D(e,"x2","y"),{x:i}=D(e,"x","y");for(const r of t)o.push(S([i[0],i[1]],[r,r],r)),o.push(S([a[0],a[1]],[r,r],r,{showlegend:!1,xaxis:"x2",yaxis:"y"}))}return o}function K(t,e,s={}){const n=[];return e.forEach((o,a)=>{n.push({name:s.name,legendgroup:s.name,showlegend:a===0,...X,...s,x:t,y:o})}),n}function Q(t=[],e=[]){return k.all([C,{xaxis:{tickvals:e,ticktext:t},yaxis:{}}])}function U(t){const s=H(t[0].bandsData.path).map(q),n=z(t[0].bandsData.paths),o=Q(s,n);let a=[];for(const[i,r]of t.entries()){let f=r.traceFormat;(!f||Object.keys(f).length===0)&&(f={name:`Band Structure ${i}`,line:{color:P(i),width:1}});const u=r.bandsData,{xs:l,ys:h}=W(u),x=K(l,h,f);a.push(...x)}return{bandTraces:a,bandLayout:o}}function Z(t="h"){let e;return t==="v"?e=R:e=_,e}function ee(t,e="h",s={}){const n=e==="v"?t.y:t.x,o=e==="v"?t.x:t.y;return{...O,...s,x:n,y:o}}function te(t,e="h"){const s=[];for(const[o,a]of t.entries()){let i=a.traceFormat;(!i||Object.keys(i).length===0)&&(i={name:`DOS ${o}`,line:{color:P(o),width:2}});const r=a.dosData,f=ee(r,e,i);s.push(f)}const n=Z(e);return{dosTraces:s,dosLayout:n}}function se(t,e,s,n={},o=1){const a=A(s),i=A(e),r=[];return i.forEach((f,u)=>{const l=a[u],h=new Float64Array(f.length),x=new Float64Array(f.length);for(let c=0;c<f.length;c++){const g=l[c]*o;h[c]=f[c]+g,x[c]=f[c]-g}const p=t.length,d=new Float32Array(p*2),y=new Float32Array(p*2);for(let c=0;c<p;c++)d[c]=t[c],y[c]=x[c],d[2*p-1-c]=t[c],y[2*p-1-c]=h[c];r.push({name:n.name,legendgroup:n.name,type:"scatter",mode:"lines",fill:"toself",...n,showlegend:u===0,x:d,y})}),r}function ne(t,e){for(const s in t)t[s]!==null&&typeof t[s]=="object"&&!Array.isArray(t[s])&&e[s]&&typeof e[s]=="object"&&!Array.isArray(e[s])?e[s]=k(e[s],t[s]):e[s]=t[s]}function oe(t,{bandsDataArray:e=[],dosDataArray:s=[],fermiLevels:n=[],customTraces:o=[],settings:a={}}){let i=[],r={},f=[],u=[],l={};typeof n=="number"&&(n=[n]);const h=e.length>0,x=s.length>0;if(h){const c=U(e);i=c.bandTraces,r=c.bandLayout;for(const[g,w]of e.entries())if(w.hasOwnProperty("projections"))for(const[j,F]of w.projections.entries()){const M=F.traceFormat&&Object.keys(F.traceFormat).length>0?F.traceFormat:{name:`Projection ${j}`,line:{color:P(j),width:0}};f.push(...se(w.bandsData.x,w.bandsData.y,F.projData.weights,M))}}if(x){const g=te(s,h?"v":"h");u=g.dosTraces,l=g.dosLayout}let p={},d=[];if(x&&!h)d=u,p={...l,showlegend:(l==null?void 0:l.showlegend)??!0};else if(h&&!x)d=[...i,...f],p={...r,showlegend:(r==null?void 0:r.showlegend)??!0};else if(x&&h){u=u.map(g=>({...g,xaxis:"x2",yaxis:"y"}));const c=N([...f,...u]);d=[...i,...c],p={...E,xaxis:{...E.xaxis||{},...(r==null?void 0:r.xaxis)||{}},xaxis2:{...E.xaxis2||{},...(l==null?void 0:l.xaxis2)||{}},yaxis:{...E.yaxis||{},...(r==null?void 0:r.yaxis)||{},...(l==null?void 0:l.yaxis)||{}}}}for(const c of o)console.log(c),c.target==="dos"?d.push({...c,xaxis:"x2",yaxis:"y"}):c.target==="bands"?d.push({...c,xaxis:"x",yaxis:"y"}):d.push({...c});const y=J(n,d,x,h);ne(a,p),$.react(t,y,p,{displaylogo:!1,responsive:!0})}const L={"bands-plot":"_bands-plot_1bv65_1","bands-note":"_bands-note_1bv65_1"},ce=({element:t,activeAccuracy:e})=>{const s=b.useRef(null),[n,o]=b.useState(),[a,i]=b.useState(!0),[r,f]=b.useState([]),[u,l]=b.useState(["REF"]),[h,x]=b.useState({});return b.useEffect(()=>{if(!t)return;new I().fetchBandsData(e).then(d=>{const y=d[t];o(y);const c=y&&Object.keys(y);f(c),x(c==null?void 0:c.reduce((g,w,j)=>(g[w]=T[j%T.length],g),{}))}).catch(d=>{console.error("Error fetching bands data:",d),o(void 0),f([]),x({})}).finally(()=>{i(!1)})},[e,t]),b.useEffect(()=>{if(n&&s.current){const p=u.map(d=>({bandsData:n[d],traceFormat:{line:{color:h[d]||"black"}}}));oe(s.current,{bandsDataArray:p,settings:{showlegend:!1}})}},[u,n]),a?m.jsx(Y,{}):n?m.jsxs("div",{id:"bands-plots",children:[m.jsxs(V,{children:[m.jsx(B,{md:3,lg:2,children:m.jsx(G,{pseudos:r,activePseudos:u,pseudosColormap:h,setActivePseudos:l})}),m.jsx(B,{children:m.jsx("div",{ref:s,id:L["bands-plot"]})})]}),m.jsx("div",{id:L["bands-note"],children:"Electronic band structure along high-symmetry path. The reference energy (0 eV) corresponds to the Fermi level."})]}):m.jsx("span",{children:"No data available"})};export{ce as default};
