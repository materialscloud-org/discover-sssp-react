import{d as L,p as C,t as X,b as O,c as R,e as _,f as E,P as $,r as b,S as I,j as m,L as Y}from"./index-B_FtDqyQ.js";import{c as T,R as V,C as A,P as G}from"./PseudosCheckboxes-D1p537Fx.js";function B(t){const e=t.length,s=t[0].length,n=new Array(s);for(let o=0;o<s;o++){n[o]=new Array(e);for(let a=0;a<e;a++)n[o][a]=t[a][o]}return n}const v=["#636EFA","#EF553B","#00CC96","#AB63FA","#FFA15A","#19D3F3","#FF6692","#B6E880","#FF97FF","#FECB52"];function P(t){return t<v.length?v[t]:`hsl(${t*47%360}, 70%, 50%)`}function N(t){const e=new Set;return t.map(n=>{const o=n.name||"",a=!e.has(o);return a&&e.add(o),{...n,legendgroup:o,showlegend:a}})}function W(t){const e=[],s=[];let n=null;return t.paths.forEach((o,a)=>{const i=o.x,r=o.values;a>0&&(e.push(null),s.forEach(u=>u.push(null))),i.forEach((u,d)=>{u===n&&(e.push(null),s.forEach(l=>l.push(null))),e.push(u),n=u,r.forEach((l,f)=>{s[f]||(s[f]=[]),s[f].push(l[d])})})}),{xs:e,ys:s}}function q(t){const e={GAMMA:"Γ",DELTA:"Δ",SIGMA:"Σ",LAMBDA:"Λ"};Object.keys(e).forEach(n=>{const o=new RegExp(n,"gi");t=t.replace(o,e[n])}),t=t.replace(/\bG\b/g,"Γ"),t=t.replace(/-/g,"—");const s={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉"};return t=t.replace(/_(.)/g,(n,o)=>s[o]||n),t}function z(t=td.paths){const e=[0];for(const s of t)s.x.length<3||e.push(s.x[s.x.length-1]);return e}function H(t){const e=t.flat(),s=[];s.push(e[0]);for(let n=1;n<e.length-1;n++)e[n]===e[n+1]?(s.push(e[n]),n++):(s.push(e[n]+"|"+e[n+1]),n++);return s.push(e[e.length-1]),s}function D(t,e="x",s="y"){let n=1/0,o=-1/0,a=1/0,i=-1/0;for(const r of t){const u=r.xaxis===e||!r.xaxis&&e==="x",d=r.yaxis===s||!r.yaxis&&s==="y";if(!(!u||!d)){for(const l of r.x??[])typeof l=="number"&&(n=Math.min(n,l),o=Math.max(o,l));for(const l of r.y??[])typeof l=="number"&&(a=Math.min(a,l),i=Math.max(i,l))}}return{x:n===1/0?null:[n,o],y:a===1/0?null:[a,i]}}function S(t,e,s,n={}){return{x:t,y:e,mode:"lines",type:"scatter",name:`Fermi [${s}eV]`,legendgroup:`fermi-${s}`,showlegend:n.showlegend??!0,line:{color:"green",width:1.25,dash:"dash"},...n}}function J(t,e,s,n){const o=[...e];if(s&&!n){const{y:a}=D(e);for(const i of t)o.push(S([i,i],[a[0],a[1]],i))}else if(n&&!s){const{x:a}=D(e);for(const i of t)o.push(S([a[0],a[1]],[i,i],i))}else if(n&&s){const{x:a}=D(e,"x2","y"),{x:i}=D(e,"x","y");for(const r of t)o.push(S([i[0],i[1]],[r,r],r)),o.push(S([a[0],a[1]],[r,r],r,{showlegend:!1,xaxis:"x2",yaxis:"y"}))}return o}function K(t,e,s={}){const n=[];return e.forEach((o,a)=>{n.push({name:s.name,legendgroup:s.name,showlegend:a===0,...X,...s,x:t,y:o})}),n}function Q(t=[],e=[]){return L.all([C,{xaxis:{tickvals:e,ticktext:t},yaxis:{}}])}function U(t){const s=H(t[0].bandsData.path).map(q),n=z(t[0].bandsData.paths),o=Q(s,n);let a=[];for(const[i,r]of t.entries()){let u=r.traceFormat;(!u||Object.keys(u).length===0)&&(u={name:`Band Structure ${i}`,line:{color:P(i),width:1}});const d=r.bandsData,{xs:l,ys:f}=W(d),p=K(l,f,u);a.push(...p)}return{bandTraces:a,bandLayout:o}}function Z(t="h"){let e;return t==="v"?e=R:e=_,e}function ee(t,e="h",s={}){const n=e==="v"?t.y:t.x,o=e==="v"?t.x:t.y;return{...O,...s,x:n,y:o}}function te(t,e="h"){const s=[];for(const[o,a]of t.entries()){let i=a.traceFormat;(!i||Object.keys(i).length===0)&&(i={name:`DOS ${o}`,line:{color:P(o),width:2}});const r=a.dosData,u=ee(r,e,i);s.push(u)}const n=Z(e);return{dosTraces:s,dosLayout:n}}function se(t,e,s,n={},o=1){const a=B(s),i=B(e),r=[];return i.forEach((u,d)=>{const l=a[d],f=new Float64Array(u.length),p=new Float64Array(u.length);for(let c=0;c<u.length;c++){const g=l[c]*o;f[c]=u[c]+g,p[c]=u[c]-g}const x=t.length,h=new Float32Array(x*2),y=new Float32Array(x*2);for(let c=0;c<x;c++)h[c]=t[c],y[c]=p[c],h[2*x-1-c]=t[c],y[2*x-1-c]=f[c];r.push({name:n.name,legendgroup:n.name,type:"scatter",mode:"lines",fill:"toself",...n,showlegend:d===0,x:h,y})}),r}function ne(t,e){for(const s in t)t[s]!==null&&typeof t[s]=="object"&&!Array.isArray(t[s])&&e[s]&&typeof e[s]=="object"&&!Array.isArray(e[s])?e[s]=L(e[s],t[s]):e[s]=t[s]}function oe(t,{bandsDataArray:e=[],dosDataArray:s=[],fermiLevels:n=[],customTraces:o=[],settings:a={}}){let i=[],r={},u=[],d=[],l={};typeof n=="number"&&(n=[n]);const f=e.length>0,p=s.length>0;if(f){const c=U(e);i=c.bandTraces,r=c.bandLayout;for(const[g,w]of e.entries())if(w.hasOwnProperty("projections"))for(const[j,F]of w.projections.entries()){const M=F.traceFormat&&Object.keys(F.traceFormat).length>0?F.traceFormat:{name:`Projection ${j}`,line:{color:P(j),width:0}};u.push(...se(w.bandsData.x,w.bandsData.y,F.projData.weights,M))}}if(p){const g=te(s,f?"v":"h");d=g.dosTraces,l=g.dosLayout}let x={},h=[];if(p&&!f)h=d,x={...l,showlegend:(l==null?void 0:l.showlegend)??!0};else if(f&&!p)h=[...i,...u],x={...r,showlegend:(r==null?void 0:r.showlegend)??!0};else if(p&&f){d=d.map(g=>({...g,xaxis:"x2",yaxis:"y"}));const c=N([...u,...d]);h=[...i,...c],x={...E,xaxis:{...E.xaxis||{},...(r==null?void 0:r.xaxis)||{}},xaxis2:{...E.xaxis2||{},...(l==null?void 0:l.xaxis2)||{}},yaxis:{...E.yaxis||{},...(r==null?void 0:r.yaxis)||{},...(l==null?void 0:l.yaxis)||{}}}}for(const c of o)console.log(c),c.target==="dos"?h.push({...c,xaxis:"x2",yaxis:"y"}):c.target==="bands"?h.push({...c,xaxis:"x",yaxis:"y"}):h.push({...c});const y=J(n,h,p,f);ne(a,x),$.react(t,y,x,{displaylogo:!1,responsive:!0})}const k={"bands-plot":"_bands-plot_1bv65_1","bands-note":"_bands-note_1bv65_1"},ce=({element:t,activeLibrary:e})=>{const[s,n]=b.useState(!0),[o,a]=b.useState([]),[i,r]=b.useState(["REF"]),[u,d]=b.useState(),[l,f]=b.useState({}),p=b.useRef(null);return b.useEffect(()=>{if(!t)return;new I().fetchBandsData(e).then(h=>{const y=h[t];d(y);const c=y&&Object.keys(y);a(c),f(c==null?void 0:c.reduce((g,w,j)=>(g[w]=T[j%T.length],g),{}))}).catch(h=>{console.error("Error fetching bands data:",h),d(void 0),a([]),f({})}).finally(()=>{n(!1)})},[e,t]),b.useEffect(()=>{if(u&&p.current){const x=i.map(h=>({bandsData:u[h],traceFormat:{line:{color:l[h]||"black"}}}));oe(p.current,{bandsDataArray:x,settings:{showlegend:!1}})}},[i,u]),s?m.jsx(Y,{}):u?m.jsxs("div",{id:"bands-plots",children:[m.jsxs(V,{children:[m.jsx(A,{md:3,lg:2,children:m.jsx(G,{pseudos:o,activePseudos:i,pseudosColormap:l,setActivePseudos:r})}),m.jsx(A,{children:m.jsx("div",{ref:p,id:k["bands-plot"]})})]}),m.jsx("div",{id:k["bands-note"],children:"Electronic band structure along high-symmetry path. The reference energy (0 eV) corresponds to the Fermi level."})]}):m.jsx("span",{children:"No data available"})};export{ce as default};
